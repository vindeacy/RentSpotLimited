generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String    @id @default(uuid())
  role         String
  email        String    @unique
  passwordHash String
  name         String?
  phone        String?
  isActive     Boolean   @default(true)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  landlord     Landlord?
  messagesFrom Message[] @relation("fromUser")
  messagesTo   Message[] @relation("toUser")
  tenant       Tenant?
}

model Landlord {
  id          String     @id @default(uuid())
  userId      String     @unique
  companyName String?
  verified    Boolean    @default(false)
  createdAt   DateTime   @default(now())
  user        User       @relation(fields: [userId], references: [id])
  leases      Lease[]
  properties  Property[]
}

model Tenant {
  id                       String    @id @default(uuid())
  userId                   String    @unique
  dob                      DateTime?
  idDocUrl                 String?
  createdAt                DateTime  @default(now())
  leaseId                  String?
  verified                 Boolean   @default(false)
  bankAccountInfo          Json?
  currentPropertyId        String?
  documentsUploaded        Boolean   @default(false)
  emergencyContactEmail    String?
  emergencyContactName     String?
  emergencyContactPhone    String?
  emergencyContactRelation String?
  maxRent                  Float?
  moveInDate               DateTime?
  petOwner                 Boolean   @default(false)
  preferredAreas           String[]  @default([])
  preferredPaymentMethod   String?
  previousAddress          String?
  profileCompleted         Boolean   @default(false)
  smokingStatus            String?   @default("non-smoker")
  leases                   Lease[]
  payments                 Payment[]
  currentProperty          Property? @relation(fields: [currentPropertyId], references: [id])
  user                     User      @relation(fields: [userId], references: [id])
}

model Payment {
  id            String    @id @default(uuid())
  tenantId      String
  leaseId       String
  amount        Float
  dueDate       DateTime
  paidDate      DateTime?
  paymentMethod String?
  status        String    @default("pending")
  reference     String?
  notes         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  lease         Lease     @relation(fields: [leaseId], references: [id])
  tenant        Tenant    @relation(fields: [tenantId], references: [id])
}

model Property {
  id             String          @id @default(uuid())
  landlordId     String
  title          String
  slug           String          @unique
  description    String?
  addressLine    String?
  city           String?
  state          String?
  postalCode     String?
  country        String?
  latitude       Float?
  longitude      Float?
  price          Float
  currency       String?
  deposit        Float?
  availableFrom  DateTime?
  propertyType   String?
  bedrooms       Int?
  bathrooms      Int?
  size           Int?
  amenities      String[]        @default([])
  status         String          @default("vacant")
  seoTitle       String?
  seoDescription String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  applications   Application[]
  leases         Lease[]
  messages       Message[]
  landlord       Landlord        @relation(fields: [landlordId], references: [id])
  images         PropertyImage[]
  tenants        Tenant[]
}

model PropertyImage {
  id         String   @id @default(uuid())
  propertyId String
  url        String
  alt        String?
  position   Int      @default(0)
  property   Property @relation(fields: [propertyId], references: [id])
}

model Application {
  id             String   @id @default(uuid())
  propertyId     String
  tenantUserId   String?
  applicantName  String?
  applicantEmail String?
  docs           Json?
  status         String   @default("new")
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  property       Property @relation(fields: [propertyId], references: [id])
}

model Lease {
  id         String    @id @default(uuid())
  propertyId String
  tenantId   String?
  landlordId String
  startDate  DateTime?
  endDate    DateTime?
  rent       Float?
  status     String    @default("pending")
  createdAt  DateTime  @default(now())
  landlord   Landlord  @relation(fields: [landlordId], references: [id])
  property   Property  @relation(fields: [propertyId], references: [id])
  tenant     Tenant?   @relation(fields: [tenantId], references: [id])
  payments   Payment[]
}

model Message {
  id         String    @id @default(uuid())
  fromUserId String?
  toUserId   String?
  propertyId String?
  subject    String?
  body       String?
  read       Boolean   @default(false)
  createdAt  DateTime  @default(now())
  fromUser   User?     @relation("fromUser", fields: [fromUserId], references: [id])
  property   Property? @relation(fields: [propertyId], references: [id])
  toUser     User?     @relation("toUser", fields: [toUserId], references: [id])
}
